version: '3.8'

# MCP Servers Docker Compose - Complete Infrastructure
# Builds and runs ALL MCP servers from local git submodules
# These servers expose stdio-based MCP protocol over TCP using socat
#
# Port Ranges:
#   9101-9199: Core MCP servers (from MCP-Servers monorepo)
#   9201-9299: Database MCP servers
#   9301-9399: Vector database MCP servers
#   9401-9499: DevOps/Infrastructure MCP servers
#   9501-9599: Browser automation MCP servers
#   9601-9699: Communication MCP servers
#   9701-9799: Productivity MCP servers
#   9801-9899: Search/AI MCP servers
#   9901-9999: Cloud provider MCP servers

services:
  # =============================================================================
  # Core MCP Servers (from MCP-Servers monorepo) - Ports 9101-9199
  # =============================================================================

  mcp-fetch:
    build:
      context: ../../MCP-Servers
      dockerfile: ../../docker/mcp/Dockerfile.mcp-server
      args:
        SERVER_NAME: fetch
    container_name: helixagent-mcp-fetch
    ports:
      - "9101:9000"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "9000"]
      interval: 10s
      timeout: 5s
      retries: 3

  mcp-git:
    build:
      context: ../../MCP-Servers
      dockerfile: ../../docker/mcp/Dockerfile.mcp-server
      args:
        SERVER_NAME: git
    container_name: helixagent-mcp-git
    ports:
      - "9102:9000"
    volumes:
      - ${HOME}:/home/user:ro
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "9000"]
      interval: 10s
      timeout: 5s
      retries: 3

  mcp-time:
    build:
      context: ../../MCP-Servers
      dockerfile: ../../docker/mcp/Dockerfile.mcp-server
      args:
        SERVER_NAME: time
    container_name: helixagent-mcp-time
    ports:
      - "9103:9000"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "9000"]
      interval: 10s
      timeout: 5s
      retries: 3

  mcp-filesystem:
    build:
      context: ../../MCP-Servers
      dockerfile: ../../docker/mcp/Dockerfile.mcp-server
      args:
        SERVER_NAME: filesystem
    container_name: helixagent-mcp-filesystem
    ports:
      - "9104:9000"
    volumes:
      - ${HOME}:/home/user
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "9000"]
      interval: 10s
      timeout: 5s
      retries: 3

  mcp-memory:
    build:
      context: ../../MCP-Servers
      dockerfile: ../../docker/mcp/Dockerfile.mcp-server
      args:
        SERVER_NAME: memory
    container_name: helixagent-mcp-memory
    ports:
      - "9105:9000"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "9000"]
      interval: 10s
      timeout: 5s
      retries: 3

  mcp-everything:
    build:
      context: ../../MCP-Servers
      dockerfile: ../../docker/mcp/Dockerfile.mcp-server
      args:
        SERVER_NAME: everything
    container_name: helixagent-mcp-everything
    ports:
      - "9106:9000"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "9000"]
      interval: 10s
      timeout: 5s
      retries: 3

  mcp-sequentialthinking:
    build:
      context: ../../MCP-Servers
      dockerfile: ../../docker/mcp/Dockerfile.mcp-server
      args:
        SERVER_NAME: sequentialthinking
    container_name: helixagent-mcp-sequentialthinking
    ports:
      - "9107:9000"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "9000"]
      interval: 10s
      timeout: 5s
      retries: 3

  # =============================================================================
  # Database MCP Servers - Ports 9201-9299
  # =============================================================================

  mcp-redis:
    build:
      context: ../../MCP/submodules/redis-mcp
      dockerfile: ../../docker/mcp/Dockerfile.mcp-python
    container_name: helixagent-mcp-redis-server
    ports:
      - "9201:9000"
    environment:
      - REDIS_URL=redis://:helixagent123@mcp-redis-backend:6379
    depends_on:
      - mcp-redis-backend
    restart: unless-stopped

  mcp-redis-backend:
    image: redis:7-alpine
    container_name: helixagent-mcp-redis-backend
    ports:
      - "16379:6379"
    command: redis-server --requirepass helixagent123
    volumes:
      - mcp-redis-data:/data
    restart: unless-stopped

  mcp-mongodb:
    build:
      context: ../../MCP/submodules/mongodb-mcp
      dockerfile: ../../docker/mcp/Dockerfile.mcp-submodule
    container_name: helixagent-mcp-mongodb-server
    ports:
      - "9202:9000"
    environment:
      - MONGODB_URI=mongodb://helixagent:helixagent123@mcp-mongodb-backend:27017/helixagent?authSource=admin
    depends_on:
      - mcp-mongodb-backend
    restart: unless-stopped

  mcp-mongodb-backend:
    image: mongo:7
    container_name: helixagent-mcp-mongodb-backend
    ports:
      - "27017:27017"
    environment:
      - MONGO_INITDB_ROOT_USERNAME=helixagent
      - MONGO_INITDB_ROOT_PASSWORD=helixagent123
    volumes:
      - mcp-mongodb-data:/data/db
    restart: unless-stopped

  mcp-supabase:
    build:
      context: ../../MCP/submodules/supabase-mcp
      dockerfile: ../../docker/mcp/Dockerfile.mcp-submodule
    container_name: helixagent-mcp-supabase
    ports:
      - "9203:9000"
    environment:
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_KEY=${SUPABASE_KEY}
    restart: unless-stopped

  # =============================================================================
  # Vector Database MCP Servers - Ports 9301-9399
  # =============================================================================

  mcp-qdrant:
    build:
      context: ../../MCP/submodules/qdrant-mcp
      dockerfile: ../../docker/mcp/Dockerfile.mcp-python
    container_name: helixagent-mcp-qdrant-server
    ports:
      - "9301:9000"
    environment:
      - QDRANT_URL=http://mcp-qdrant-backend:6333
    depends_on:
      - mcp-qdrant-backend
    restart: unless-stopped

  mcp-qdrant-backend:
    image: qdrant/qdrant:latest
    container_name: helixagent-mcp-qdrant-backend
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - mcp-qdrant-data:/qdrant/storage
    restart: unless-stopped

  # =============================================================================
  # DevOps/Infrastructure MCP Servers - Ports 9401-9499
  # =============================================================================

  mcp-kubernetes:
    build:
      context: ../../MCP/submodules/kubernetes-mcp
      dockerfile: ../../docker/mcp/Dockerfile.mcp-go
    container_name: helixagent-mcp-kubernetes
    ports:
      - "9401:9000"
    volumes:
      - ${HOME}/.kube:/root/.kube:ro
    restart: unless-stopped

  mcp-github:
    build:
      context: ../../MCP/submodules/github-mcp-server
      dockerfile: ../../docker/mcp/Dockerfile.mcp-go
    container_name: helixagent-mcp-github
    ports:
      - "9402:9000"
    environment:
      - GITHUB_PERSONAL_ACCESS_TOKEN=${GITHUB_TOKEN}
    restart: unless-stopped

  mcp-cloudflare:
    build:
      context: ../../MCP/submodules/cloudflare-mcp
      dockerfile: ../../docker/mcp/Dockerfile.mcp-submodule
    container_name: helixagent-mcp-cloudflare
    ports:
      - "9403:9000"
    environment:
      - CLOUDFLARE_API_TOKEN=${CLOUDFLARE_API_TOKEN}
      - CLOUDFLARE_ACCOUNT_ID=${CLOUDFLARE_ACCOUNT_ID}
    restart: unless-stopped

  mcp-heroku:
    build:
      context: ../../MCP/submodules/heroku-mcp
      dockerfile: ../../docker/mcp/Dockerfile.mcp-submodule
    container_name: helixagent-mcp-heroku
    ports:
      - "9404:9000"
    environment:
      - HEROKU_API_KEY=${HEROKU_API_KEY}
    restart: unless-stopped

  mcp-sentry:
    build:
      context: ../../MCP/submodules/sentry-mcp
      dockerfile: ../../docker/mcp/Dockerfile.mcp-submodule
    container_name: helixagent-mcp-sentry
    ports:
      - "9405:9000"
    environment:
      - SENTRY_AUTH_TOKEN=${SENTRY_AUTH_TOKEN}
      - SENTRY_ORG=${SENTRY_ORG}
    restart: unless-stopped

  # =============================================================================
  # Browser Automation MCP Servers - Ports 9501-9599
  # =============================================================================

  mcp-playwright:
    build:
      context: ../../MCP/submodules/playwright-mcp
      dockerfile: ../../docker/mcp/Dockerfile.mcp-playwright
    container_name: helixagent-mcp-playwright
    ports:
      - "9501:9000"
    restart: unless-stopped

  mcp-browserbase:
    build:
      context: ../../MCP/submodules/browserbase-mcp
      dockerfile: ../../docker/mcp/Dockerfile.mcp-submodule
    container_name: helixagent-mcp-browserbase
    ports:
      - "9502:9000"
    environment:
      - BROWSERBASE_API_KEY=${BROWSERBASE_API_KEY}
      - BROWSERBASE_PROJECT_ID=${BROWSERBASE_PROJECT_ID}
    restart: unless-stopped

  mcp-firecrawl:
    build:
      context: ../../MCP/submodules/firecrawl-mcp
      dockerfile: ../../docker/mcp/Dockerfile.mcp-submodule
    container_name: helixagent-mcp-firecrawl
    ports:
      - "9503:9000"
    environment:
      - FIRECRAWL_API_KEY=${FIRECRAWL_API_KEY}
    restart: unless-stopped

  # =============================================================================
  # Communication MCP Servers - Ports 9601-9699
  # =============================================================================

  mcp-slack:
    build:
      context: ../../MCP/submodules/slack-mcp
      dockerfile: ../../docker/mcp/Dockerfile.mcp-go
    container_name: helixagent-mcp-slack
    ports:
      - "9601:9000"
    environment:
      - SLACK_BOT_TOKEN=${SLACK_BOT_TOKEN}
      - SLACK_TEAM_ID=${SLACK_TEAM_ID}
    restart: unless-stopped

  mcp-telegram:
    build:
      context: ../../MCP/submodules/telegram-mcp
      dockerfile: ../../docker/mcp/Dockerfile.mcp-python
    container_name: helixagent-mcp-telegram
    ports:
      - "9602:9000"
    environment:
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
    restart: unless-stopped

  # =============================================================================
  # Productivity MCP Servers - Ports 9701-9799
  # =============================================================================

  mcp-notion:
    build:
      context: ../../MCP/submodules/notion-mcp-server
      dockerfile: ../../docker/mcp/Dockerfile.mcp-submodule
    container_name: helixagent-mcp-notion
    ports:
      - "9701:9000"
    environment:
      - NOTION_API_KEY=${NOTION_API_KEY}
    restart: unless-stopped

  mcp-trello:
    build:
      context: ../../MCP/submodules/trello-mcp
      dockerfile: ../../docker/mcp/Dockerfile.mcp-submodule
    container_name: helixagent-mcp-trello
    ports:
      - "9702:9000"
    environment:
      - TRELLO_API_KEY=${TRELLO_API_KEY}
      - TRELLO_TOKEN=${TRELLO_TOKEN}
    restart: unless-stopped

  mcp-airtable:
    build:
      context: ../../MCP/submodules/airtable-mcp
      dockerfile: ../../docker/mcp/Dockerfile.mcp-submodule
    container_name: helixagent-mcp-airtable
    ports:
      - "9703:9000"
    environment:
      - AIRTABLE_API_KEY=${AIRTABLE_API_KEY}
    restart: unless-stopped

  mcp-obsidian:
    build:
      context: ../../MCP/submodules/obsidian-mcp
      dockerfile: ../../docker/mcp/Dockerfile.mcp-submodule
    container_name: helixagent-mcp-obsidian
    ports:
      - "9704:9000"
    volumes:
      - ${HOME}/Obsidian:/vault:ro
    restart: unless-stopped

  mcp-atlassian:
    build:
      context: ../../MCP/submodules/atlassian-mcp
      dockerfile: ../../docker/mcp/Dockerfile.mcp-python
    container_name: helixagent-mcp-atlassian
    ports:
      - "9705:9000"
    environment:
      - ATLASSIAN_URL=${ATLASSIAN_URL}
      - ATLASSIAN_EMAIL=${ATLASSIAN_EMAIL}
      - ATLASSIAN_API_TOKEN=${ATLASSIAN_API_TOKEN}
    restart: unless-stopped

  # =============================================================================
  # Search/AI MCP Servers - Ports 9801-9899
  # =============================================================================

  mcp-brave-search:
    build:
      context: ../../MCP/submodules/brave-search
      dockerfile: ../../docker/mcp/Dockerfile.mcp-submodule
    container_name: helixagent-mcp-brave-search
    ports:
      - "9801:9000"
    environment:
      - BRAVE_API_KEY=${BRAVE_API_KEY}
    restart: unless-stopped

  mcp-perplexity:
    build:
      context: ../../MCP/submodules/perplexity-mcp
      dockerfile: ../../docker/mcp/Dockerfile.mcp-submodule
    container_name: helixagent-mcp-perplexity
    ports:
      - "9802:9000"
    environment:
      - PERPLEXITY_API_KEY=${PERPLEXITY_API_KEY}
    restart: unless-stopped

  mcp-omnisearch:
    build:
      context: ../../MCP/submodules/omnisearch-mcp
      dockerfile: ../../docker/mcp/Dockerfile.mcp-submodule
    container_name: helixagent-mcp-omnisearch
    ports:
      - "9803:9000"
    restart: unless-stopped

  mcp-context7:
    build:
      context: ../../MCP/submodules/context7-mcp
      dockerfile: ../../docker/mcp/Dockerfile.mcp-submodule
    container_name: helixagent-mcp-context7
    ports:
      - "9804:9000"
    restart: unless-stopped

  mcp-llamaindex:
    build:
      context: ../../MCP/submodules/llamaindex-mcp
      dockerfile: ../../docker/mcp/Dockerfile.mcp-submodule
    container_name: helixagent-mcp-llamaindex
    ports:
      - "9805:9000"
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
    restart: unless-stopped

  # =============================================================================
  # Cloud Provider MCP Servers - Ports 9901-9999
  # =============================================================================

  mcp-workers:
    build:
      context: ../../MCP/submodules/workers-mcp
      dockerfile: ../../docker/mcp/Dockerfile.mcp-submodule
    container_name: helixagent-mcp-workers
    ports:
      - "9901:9000"
    environment:
      - CLOUDFLARE_API_TOKEN=${CLOUDFLARE_API_TOKEN}
      - CLOUDFLARE_ACCOUNT_ID=${CLOUDFLARE_ACCOUNT_ID}
    restart: unless-stopped

volumes:
  mcp-redis-data:
  mcp-mongodb-data:
  mcp-qdrant-data:

networks:
  default:
    name: helixagent-mcp-network
