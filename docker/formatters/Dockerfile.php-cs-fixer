# Dockerfile for php-cs-fixer PHP formatter service
FROM php:8.3-cli-alpine

LABEL maintainer="HelixAgent <dev@helixagent.ai>"
LABEL description="php-cs-fixer PHP formatter service"
LABEL version="3.68.0"

# Install php-cs-fixer
RUN wget https://cs.symfony.com/download/php-cs-fixer-v3.68.0.phar -O /usr/local/bin/php-cs-fixer && \
    chmod +x /usr/local/bin/php-cs-fixer

# Install Python for HTTP wrapper
RUN apk add --no-cache python3 py3-pip

# Create service user
RUN adduser -D -u 1000 formatter && \
    mkdir -p /workspace && \
    chown -R formatter:formatter /workspace

USER formatter
WORKDIR /workspace

# Expose service port
EXPOSE 9240

# Health check
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
    CMD php-cs-fixer --version || exit 1

# Run HTTP service wrapper
COPY --chown=formatter:formatter formatter-service.py /app/formatter-service.py
CMD ["python3", "/app/formatter-service.py", "--formatter", "php-cs-fixer", "--port", "9240"]
