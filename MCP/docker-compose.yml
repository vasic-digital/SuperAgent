# HelixAgent MCP Servers - Docker Compose Configuration
# All 48 MCP server submodules ready for containerized deployment
# Use: docker-compose -f MCP/docker-compose.yml up -d
version: '3.8'

x-mcp-base: &mcp-base
  restart: unless-stopped
  networks:
    - helixagent-network
  logging:
    driver: json-file
    options:
      max-size: "10m"
      max-file: "3"

services:
  # ============================================
  # CORE MCP SERVERS (No Auth Required)
  # ============================================

  mcp-everything:
    <<: *mcp-base
    build:
      context: ../MCP-Servers
      dockerfile: ../MCP/dockerfiles/Dockerfile.everything
    container_name: mcp-everything
    ports:
      - "3001:3000"
    healthcheck:
      test: ["CMD", "node", "-e", "console.log('healthy')"]
      interval: 30s
      timeout: 10s
      retries: 3

  mcp-filesystem:
    <<: *mcp-base
    build:
      context: ../MCP-Servers
      dockerfile: ../MCP/dockerfiles/Dockerfile.filesystem
    container_name: mcp-filesystem
    ports:
      - "3002:3000"
    volumes:
      - ${HOME}:/mnt/home:ro
      - /tmp:/mnt/tmp:rw
      - ${PWD}:/mnt/workspace:ro

  mcp-memory:
    <<: *mcp-base
    build:
      context: ../MCP-Servers
      dockerfile: ../MCP/dockerfiles/Dockerfile.memory
    container_name: mcp-memory
    ports:
      - "3003:3000"
    volumes:
      - mcp-memory-data:/data

  mcp-sequential-thinking:
    <<: *mcp-base
    build:
      context: ../MCP-Servers
      dockerfile: ../MCP/dockerfiles/Dockerfile.sequential-thinking
    container_name: mcp-sequential-thinking
    ports:
      - "3004:3000"

  mcp-fetch:
    <<: *mcp-base
    image: python:3.11-slim
    container_name: mcp-fetch
    ports:
      - "3005:3000"
    command: ["pip", "install", "mcp-server-fetch", "&&", "mcp-server-fetch"]
    entrypoint: ["/bin/bash", "-c"]

  mcp-git:
    <<: *mcp-base
    image: python:3.11-slim
    container_name: mcp-git
    ports:
      - "3006:3000"
    command: >
      pip install mcp-server-git && mcp-server-git
    volumes:
      - ${PWD}:/workspace:ro

  mcp-time:
    <<: *mcp-base
    image: python:3.11-slim
    container_name: mcp-time
    ports:
      - "3007:3000"
    command: >
      pip install mcp-server-time && mcp-server-time

  # ============================================
  # BROWSER AUTOMATION
  # ============================================

  mcp-playwright:
    <<: *mcp-base
    build:
      context: ./submodules/playwright-mcp
      dockerfile: ../../dockerfiles/Dockerfile.playwright
    container_name: mcp-playwright
    ports:
      - "3010:3000"
    environment:
      - DISPLAY=:99
    shm_size: 2gb
    cap_add:
      - SYS_ADMIN

  mcp-browserbase:
    <<: *mcp-base
    build:
      context: ./submodules/browserbase-mcp
      dockerfile: ../../dockerfiles/Dockerfile.browserbase
    container_name: mcp-browserbase
    ports:
      - "3011:3000"
    environment:
      - BROWSERBASE_API_KEY=${BROWSERBASE_API_KEY:-}
      - BROWSERBASE_PROJECT_ID=${BROWSERBASE_PROJECT_ID:-}

  # ============================================
  # DATABASES & STORAGE
  # ============================================

  mcp-redis:
    <<: *mcp-base
    build:
      context: ./submodules/redis-mcp
      dockerfile: ../../dockerfiles/Dockerfile.redis
    container_name: mcp-redis
    ports:
      - "3020:3000"
    environment:
      - REDIS_URL=${REDIS_URL:-redis://helixagent-redis:6379}
    depends_on:
      - helixagent-redis

  mcp-mongodb:
    <<: *mcp-base
    build:
      context: ./submodules/mongodb-mcp
      dockerfile: ../../dockerfiles/Dockerfile.mongodb
    container_name: mcp-mongodb
    ports:
      - "3021:3000"
    environment:
      - MONGODB_URI=${MONGODB_URI:-mongodb://helixagent-mongo:27017/helixagent}
    depends_on:
      - helixagent-mongo

  mcp-qdrant:
    <<: *mcp-base
    build:
      context: ./submodules/qdrant-mcp
      dockerfile: ../../dockerfiles/Dockerfile.qdrant
    container_name: mcp-qdrant
    ports:
      - "3022:3000"
    environment:
      - QDRANT_URL=${QDRANT_URL:-http://helixagent-qdrant:6333}
    depends_on:
      - helixagent-qdrant

  mcp-elasticsearch:
    <<: *mcp-base
    build:
      context: ./submodules/elasticsearch-mcp
      dockerfile: ../../dockerfiles/Dockerfile.elasticsearch
    container_name: mcp-elasticsearch
    ports:
      - "3023:3000"
    environment:
      - ELASTICSEARCH_URL=${ELASTICSEARCH_URL:-http://helixagent-elasticsearch:9200}

  mcp-supabase:
    <<: *mcp-base
    build:
      context: ./submodules/supabase-mcp
      dockerfile: ../../dockerfiles/Dockerfile.supabase
    container_name: mcp-supabase
    ports:
      - "3024:3000"
    environment:
      - SUPABASE_URL=${SUPABASE_URL:-}
      - SUPABASE_KEY=${SUPABASE_KEY:-}

  # ============================================
  # VERSION CONTROL & DEVOPS
  # ============================================

  mcp-github:
    <<: *mcp-base
    build:
      context: ./submodules/github-mcp-server
      dockerfile: ../../dockerfiles/Dockerfile.github
    container_name: mcp-github
    ports:
      - "3030:3000"
    environment:
      - GITHUB_TOKEN=${GITHUB_TOKEN:-}

  mcp-sentry:
    <<: *mcp-base
    build:
      context: ./submodules/sentry-mcp
      dockerfile: ../../dockerfiles/Dockerfile.sentry
    container_name: mcp-sentry
    ports:
      - "3031:3000"
    environment:
      - SENTRY_AUTH_TOKEN=${SENTRY_AUTH_TOKEN:-}
      - SENTRY_ORG=${SENTRY_ORG:-}

  mcp-heroku:
    <<: *mcp-base
    build:
      context: ./submodules/heroku-mcp
      dockerfile: ../../dockerfiles/Dockerfile.heroku
    container_name: mcp-heroku
    ports:
      - "3032:3000"
    environment:
      - HEROKU_API_KEY=${HEROKU_API_KEY:-}

  mcp-cloudflare:
    <<: *mcp-base
    build:
      context: ./submodules/cloudflare-mcp
      dockerfile: ../../dockerfiles/Dockerfile.cloudflare
    container_name: mcp-cloudflare
    ports:
      - "3033:3000"
    environment:
      - CLOUDFLARE_API_TOKEN=${CLOUDFLARE_API_TOKEN:-}
      - CLOUDFLARE_ACCOUNT_ID=${CLOUDFLARE_ACCOUNT_ID:-}

  # ============================================
  # CLOUD PLATFORMS
  # ============================================

  mcp-aws:
    <<: *mcp-base
    build:
      context: ./submodules/aws-mcp
      dockerfile: ../../dockerfiles/Dockerfile.aws
    container_name: mcp-aws
    ports:
      - "3040:3000"
    environment:
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID:-}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY:-}
      - AWS_REGION=${AWS_REGION:-us-east-1}

  mcp-kubernetes:
    <<: *mcp-base
    build:
      context: ./submodules/kubernetes-mcp
      dockerfile: ../../dockerfiles/Dockerfile.kubernetes
    container_name: mcp-kubernetes
    ports:
      - "3041:3000"
    volumes:
      - ${HOME}/.kube/config:/root/.kube/config:ro

  # ============================================
  # PRODUCTIVITY & COMMUNICATION
  # ============================================

  mcp-slack:
    <<: *mcp-base
    build:
      context: ./submodules/slack-mcp
      dockerfile: ../../dockerfiles/Dockerfile.slack
    container_name: mcp-slack
    ports:
      - "3050:3000"
    environment:
      - SLACK_BOT_TOKEN=${SLACK_BOT_TOKEN:-}
      - SLACK_TEAM_ID=${SLACK_TEAM_ID:-}

  mcp-telegram:
    <<: *mcp-base
    build:
      context: ./submodules/telegram-mcp
      dockerfile: ../../dockerfiles/Dockerfile.telegram
    container_name: mcp-telegram
    ports:
      - "3051:3000"
    environment:
      - TELEGRAM_API_ID=${TELEGRAM_API_ID:-}
      - TELEGRAM_API_HASH=${TELEGRAM_API_HASH:-}

  mcp-notion:
    <<: *mcp-base
    build:
      context: ./submodules/notion-mcp-server
      dockerfile: ../../dockerfiles/Dockerfile.notion
    container_name: mcp-notion
    ports:
      - "3052:3000"
    environment:
      - NOTION_API_KEY=${NOTION_API_KEY:-}

  mcp-airtable:
    <<: *mcp-base
    build:
      context: ./submodules/airtable-mcp
      dockerfile: ../../dockerfiles/Dockerfile.airtable
    container_name: mcp-airtable
    ports:
      - "3053:3000"
    environment:
      - AIRTABLE_API_KEY=${AIRTABLE_API_KEY:-}

  mcp-trello:
    <<: *mcp-base
    build:
      context: ./submodules/trello-mcp
      dockerfile: ../../dockerfiles/Dockerfile.trello
    container_name: mcp-trello
    ports:
      - "3054:3000"
    environment:
      - TRELLO_API_KEY=${TRELLO_API_KEY:-}
      - TRELLO_TOKEN=${TRELLO_TOKEN:-}

  mcp-atlassian:
    <<: *mcp-base
    build:
      context: ./submodules/atlassian-mcp
      dockerfile: ../../dockerfiles/Dockerfile.atlassian
    container_name: mcp-atlassian
    ports:
      - "3055:3000"
    environment:
      - JIRA_URL=${JIRA_URL:-}
      - JIRA_EMAIL=${JIRA_EMAIL:-}
      - JIRA_API_TOKEN=${JIRA_API_TOKEN:-}
      - CONFLUENCE_URL=${CONFLUENCE_URL:-}

  mcp-obsidian:
    <<: *mcp-base
    build:
      context: ./submodules/obsidian-mcp
      dockerfile: ../../dockerfiles/Dockerfile.obsidian
    container_name: mcp-obsidian
    ports:
      - "3056:3000"
    volumes:
      - ${OBSIDIAN_VAULT_PATH:-${HOME}/Documents/Obsidian}:/vault:ro
    environment:
      - OBSIDIAN_VAULT_PATH=/vault

  # ============================================
  # SEARCH & AI
  # ============================================

  mcp-brave-search:
    <<: *mcp-base
    build:
      context: ./submodules/brave-search
      dockerfile: ../../dockerfiles/Dockerfile.brave-search
    container_name: mcp-brave-search
    ports:
      - "3060:3000"
    environment:
      - BRAVE_API_KEY=${BRAVE_API_KEY:-}

  mcp-perplexity:
    <<: *mcp-base
    build:
      context: ./submodules/perplexity-mcp
      dockerfile: ../../dockerfiles/Dockerfile.perplexity
    container_name: mcp-perplexity
    ports:
      - "3061:3000"
    environment:
      - PERPLEXITY_API_KEY=${PERPLEXITY_API_KEY:-}

  mcp-context7:
    <<: *mcp-base
    build:
      context: ./submodules/context7-mcp
      dockerfile: ../../dockerfiles/Dockerfile.context7
    container_name: mcp-context7
    ports:
      - "3062:3000"
    environment:
      - CONTEXT7_API_KEY=${CONTEXT7_API_KEY:-}

  mcp-firecrawl:
    <<: *mcp-base
    build:
      context: ./submodules/firecrawl-mcp
      dockerfile: ../../dockerfiles/Dockerfile.firecrawl
    container_name: mcp-firecrawl
    ports:
      - "3063:3000"
    environment:
      - FIRECRAWL_API_KEY=${FIRECRAWL_API_KEY:-}

  mcp-omnisearch:
    <<: *mcp-base
    build:
      context: ./submodules/omnisearch-mcp
      dockerfile: ../../dockerfiles/Dockerfile.omnisearch
    container_name: mcp-omnisearch
    ports:
      - "3064:3000"
    environment:
      - TAVILY_API_KEY=${TAVILY_API_KEY:-}
      - BRAVE_API_KEY=${BRAVE_API_KEY:-}
      - PERPLEXITY_API_KEY=${PERPLEXITY_API_KEY:-}

  # ============================================
  # AI FRAMEWORK INTEGRATIONS
  # ============================================

  mcp-langchain:
    <<: *mcp-base
    build:
      context: ./submodules/langchain-mcp
      dockerfile: ../../dockerfiles/Dockerfile.langchain
    container_name: mcp-langchain
    ports:
      - "3070:3000"
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}

  mcp-llamaindex:
    <<: *mcp-base
    build:
      context: ./submodules/llamaindex-mcp
      dockerfile: ../../dockerfiles/Dockerfile.llamaindex
    container_name: mcp-llamaindex
    ports:
      - "3071:3000"
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}

  mcp-docs:
    <<: *mcp-base
    build:
      context: ./submodules/docs-mcp
      dockerfile: ../../dockerfiles/Dockerfile.docs
    container_name: mcp-docs
    ports:
      - "3072:3000"

  # ============================================
  # MICROSOFT MCP
  # ============================================

  mcp-microsoft:
    <<: *mcp-base
    build:
      context: ./submodules/microsoft-mcp
      dockerfile: ../../dockerfiles/Dockerfile.microsoft
    container_name: mcp-microsoft
    ports:
      - "3080:3000"
    environment:
      - AZURE_TENANT_ID=${AZURE_TENANT_ID:-}
      - AZURE_CLIENT_ID=${AZURE_CLIENT_ID:-}
      - AZURE_CLIENT_SECRET=${AZURE_CLIENT_SECRET:-}

  # ============================================
  # SUPPORTING SERVICES
  # ============================================

  helixagent-redis:
    image: redis:7-alpine
    container_name: helixagent-mcp-redis
    restart: unless-stopped
    ports:
      - "16379:6379"
    command: redis-server --requirepass ${REDIS_PASSWORD:-helixagent123}
    volumes:
      - redis-data:/data
    networks:
      - helixagent-network

  helixagent-mongo:
    image: mongo:7
    container_name: helixagent-mcp-mongo
    restart: unless-stopped
    ports:
      - "27017:27017"
    environment:
      - MONGO_INITDB_ROOT_USERNAME=${MONGO_USER:-helixagent}
      - MONGO_INITDB_ROOT_PASSWORD=${MONGO_PASSWORD:-helixagent123}
    volumes:
      - mongo-data:/data/db
    networks:
      - helixagent-network

  helixagent-qdrant:
    image: qdrant/qdrant:latest
    container_name: helixagent-mcp-qdrant
    restart: unless-stopped
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - qdrant-data:/qdrant/storage
    networks:
      - helixagent-network

volumes:
  mcp-memory-data:
  redis-data:
  mongo-data:
  qdrant-data:

networks:
  helixagent-network:
    name: helixagent-network
    driver: bridge
