# HelixAgent Architecture Diagrams

## System Architecture Overview

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           HELIXAGENT SYSTEM                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         CLIENT LAYER                                 │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │  OpenCode │ Crush │ Claude Code │ VS Code │ HTTP API │ WebSocket   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                     │                                        │
│                                     ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         API GATEWAY                                  │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐              │   │
│  │  │   HTTP/3     │  │   HTTP/2     │  │  WebSocket   │              │   │
│  │  │   (QUIC)     │  │  (Fallback)  │  │   (Stream)   │              │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘              │   │
│  │                                                                      │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐              │   │
│  │  │ Rate Limiter │  │   API Key    │  │   JWT Auth   │              │   │
│  │  │  (Semaphore) │  │   Validator  │  │   Middleware │              │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘              │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                     │                                        │
│                                     ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      CORE SERVICES                                   │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │                                                                      │   │
│  │  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐  │   │
│  │  │  LLM Ensemble   │◀──▶│  Debate Engine  │◀──▶│  Memory System  │  │   │
│  │  │    Service      │    │    (5x5 Grid)   │    │  (Mem0+Cognee)  │  │   │
│  │  └────────┬────────┘    └────────┬────────┘    └────────┬────────┘  │   │
│  │           │                      │                      │           │   │
│  │           ▼                      ▼                      ▼           │   │
│  │  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐  │   │
│  │  │ Intent Router   │    │ Voting System   │    │ Vector Search   │  │   │
│  │  │ (Semantic)      │    │ (6 Methods)     │    │ (pgvector)      │  │   │
│  │  └─────────────────┘    └─────────────────┘    └─────────────────┘  │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                     │                                        │
│                                     ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                    PROVIDER LAYER (22 Providers)                     │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │                                                                      │   │
│  │  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐          │   │
│  │  │OpenAI  │ │Claude  │ │Gemini  │ │Mistral │ │DeepSeek│          │   │
│  │  └────────┘ └────────┘ └────────┘ └────────┘ └────────┘          │   │
│  │  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐          │   │
│  │  │Groq    │ │Cohere  │ │Ollama  │ │Together│ │Replicate│          │   │
│  │  └────────┘ └────────┘ └────────┘ └────────┘ └────────┘          │   │
│  │  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐          │   │
│  │  │Cloudflare│ │NVIDIA  │ │Fireworks│ │Vulavula│ │Zhipu   │          │   │
│  │  └────────┘ └────────┘ └────────┘ └────────┘ └────────┘          │   │
│  │  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐          │   │
│  │  │Kimi    │ │Hyperbolic│ │Siliconflow│ │Novita  │ │Upstage │          │   │
│  │  └────────┘ └────────┘ └────────┘ └────────┘ └────────┘          │   │
│  │  ┌────────┐ ┌────────┐                                              │   │
│  │  │Sambanova│ │Sarvam  │                                              │   │
│  │  └────────┘ └────────┘                                              │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                     │                                        │
│                                     ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      PROTOCOL LAYER                                  │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │                                                                      │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐              │   │
│  │  │     MCP      │  │     LSP      │  │     ACP      │              │   │
│  │  │   (45+       │  │  (Language   │  │   (Agent     │              │   │
│  │  │   Servers)   │  │   Servers)   │  │   Comm)      │              │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘              │   │
│  │                                                                      │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐              │   │
│  │  │ Embeddings   │  │    Vision    │  │    RAG       │              │   │
│  │  │  (6 Providers)│  │  (Analysis)  │  │  (Hybrid)    │              │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘              │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                     │                                        │
│                                     ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      DATA LAYER                                      │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │                                                                      │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐              │   │
│  │  │  PostgreSQL  │  │    Redis     │  │  ChromaDB    │              │   │
│  │  │  (Primary    │  │   (Cache &   │  │  (Vector     │              │   │
│  │  │   Database)  │  │   Queue)     │  │   Store)     │              │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘              │   │
│  │                                                                      │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐              │   │
│  │  │    MinIO     │  │   ClickHouse │  │   Cognee     │              │   │
│  │  │   (Object    │  │  (Analytics) │  │   (Knowledge │              │   │
│  │  │   Storage)   │  │              │  │    Graph)    │              │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘              │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## Debate Architecture (5×5 Grid)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         AI DEBATE ORCHESTRATION                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   Phase 1: Position Assignment (5 Positions × 5 LLMs = 25 Agents)           │
│                                                                              │
│   Position 1: "Python is best"      Position 2: "Rust is best"              │
│   ┌────────┬────────┬────────┐      ┌────────┬────────┬────────┐           │
│   │Claude  │ GPT-4  │Gemini  │      │Claude  │ GPT-4  │Gemini  │           │
│   │Sonnet  │ Turbo  │ Pro    │      │Sonnet  │ Turbo  │ Pro    │           │
│   ├────────┼────────┼────────┤      ├────────┼────────┼────────┤           │
│   │Mistral │DeepSeek│ Groq   │      │Mistral │DeepSeek│ Groq   │           │
│   │Large   │ Chat   │ Llama  │      │Large   │ Chat   │ Llama  │           │
│   └────────┴────────┴────────┘      └────────┴────────┴────────┘           │
│                                                                              │
│   Position 3: "Julia is best"     Position 4: "C++ is best"                 │
│   ┌────────┬────────┬────────┐      ┌────────┬────────┬────────┐           │
│   │Claude  │ GPT-4  │Gemini  │      │Claude  │ GPT-4  │Gemini  │           │
│   │Sonnet  │ Turbo  │ Pro    │      │Sonnet  │ Turbo  │ Pro    │           │
│   ├────────┼────────┼────────┤      ├────────┼────────┼────────┤           │
│   │Mistral │DeepSeek│ Groq   │      │Mistral │DeepSeek│ Groq   │           │
│   │Large   │ Chat   │ Llama  │      │Large   │ Chat   │ Llama  │           │
│   └────────┴────────┴────────┘      └────────┴────────┴────────┘           │
│                                                                              │
│   Position 5: "Neutral / Comparative Analysis"                               │
│   ┌────────┬────────┬────────┐                                              │
│   │Claude  │ GPT-4  │Gemini  │                                              │
│   │Sonnet  │ Turbo  │ Pro    │                                              │
│   ├────────┼────────┼────────┤                                              │
│   │Mistral │DeepSeek│ Groq   │                                              │
│   │Large   │ Chat   │ Llama  │                                              │
│   └────────┴────────┴────────┘                                              │
│                                                                              │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                    Debate Protocol (8 Phases)                        │   │
│   ├─────────────────────────────────────────────────────────────────────┤   │
│   │                                                                      │   │
│   │   1. Dehallucination    ──▶  2. Self-Evolvement                     │   │
│   │          │                         │                                │   │
│   │          ▼                         ▼                                │   │
│   │   3. Proposal           ──▶  4. Critique                            │   │
│   │          │                         │                                │   │
│   │          ▼                         ▼                                │   │
│   │   5. Review             ──▶  6. Optimization                        │   │
│   │          │                         │                                │   │
│   │          ▼                         ▼                                │   │
│   │   7. Adversarial        ──▶  8. Convergence                         │   │
│   │                                      │                              │   │
│   │                                      ▼                              │   │
│   │                              Final Vote                             │   │
│   │                                                                      │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                      Voting Methods                                 │   │
│   ├─────────────────────────────────────────────────────────────────────┤   │
│   │  ┌────────────┐  ┌────────────┐  ┌────────────┐                    │   │
│   │  │  Weighted  │  │  Majority  │  │   Borda    │                    │   │
│   │  │  (MiniMax) │  │    Vote    │  │    Count   │                    │   │
│   │  └────────────┘  └────────────┘  └────────────┘                    │   │
│   │  ┌────────────┐  ┌────────────┐  ┌────────────┐                    │   │
│   │  │  Condorcet │  │  Plurality │  │  Unanimous │                    │   │
│   │  │  (Cycles)  │  │    Vote    │  │  Consensus │                    │   │
│   │  └────────────┘  └────────────┘  └────────────┘                    │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## Request Flow Diagram

```
┌──────────┐
│  Client  │
│  Request │
└────┬─────┘
     │
     ▼
┌──────────────────────────────────────────────────────────────┐
│                    API Gateway (Gin)                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │
│  │Rate Limiter  │─▶│  Auth Check  │─▶│Feature Flags │       │
│  │ (Semaphore)  │  │(API Key/JWT) │  │ (Middleware) │       │
│  └──────────────┘  └──────────────┘  └──────────────┘       │
└──────────────────────────────────────────────────────────────┘
     │
     ▼
┌──────────────────────────────────────────────────────────────┐
│                  Intent Classification                        │
├──────────────────────────────────────────────────────────────┤
│  Input: "What are the tradeoffs between Python and Rust?"    │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │ 1. Embedding Similarity Check (Vector DB)               │ │
│  │ 2. LLM Classification (if needed)                       │ │
│  │                                                         │ │
│  │ Output: {                                               │ │
│  │   "intent": "comparative_analysis",                     │ │
│  │   "complexity": "high",                                 │ │
│  │   "requires_debate": true,                              │ │
│  │   "domain": "programming_languages"                     │ │
│  │ }                                                       │ │
│  └─────────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────────┘
     │
     ▼
┌──────────────────────────────────────────────────────────────┐
│              Route Decision (Intent-Based Router)             │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│   High Complexity? ──Yes──▶ Debate Mode (25 Agents)          │
│        │ No                                                  │
│        ▼                                                     │
│   Medium Complexity? ──Yes──▶ Ensemble Mode (3-5 Agents)     │
│        │ No                                                  │
│        ▼                                                     │
│   Standard Request ──Yes──▶ Single Provider Mode             │
│                                                              │
└──────────────────────────────────────────────────────────────┘
     │
     ▼
┌──────────────────────────────────────────────────────────────┐
│                    Memory Enhancement                         │
├──────────────────────────────────────────────────────────────┤
│  1. Extract entities from query                              │
│  2. Query Mem0/Cognee for relevant memories                  │
│  3. Inject context into prompt                               │
│  4. Update entity graph                                      │
└──────────────────────────────────────────────────────────────┘
     │
     ▼
┌──────────────────────────────────────────────────────────────┐
│              LLM Provider Selection (Registry)                │
├──────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐          │
│  │Health Check │  │  Capability │  │   Cost/     │          │
│  │   Status    │─▶│   Match     │─▶│ Performance │          │
│  │ (Real-time) │  │ (Model Fit) │  │   Score     │          │
│  └─────────────┘  └─────────────┘  └─────────────┘          │
│                                                              │
│  Providers: [OpenAI, Claude, Gemini, Mistral, DeepSeek...]   │
│  Selection Strategy: Score = Health × Capability × Cost      │
└──────────────────────────────────────────────────────────────┘
     │
     ▼
┌──────────────────────────────────────────────────────────────┐
│                 Parallel Request Execution                    │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌────────────┐    ┌────────────┐    ┌────────────┐        │
│  │ Provider 1 │    │ Provider 2 │    │ Provider N │        │
│  │  Request   │    │  Request   │    │  Request   │        │
│  └─────┬──────┘    └─────┬──────┘    └─────┬──────┘        │
│        │                  │                  │              │
│        ▼                  ▼                  ▼              │
│  ┌────────────┐    ┌────────────┐    ┌────────────┐        │
│  │  Response  │    │  Response  │    │  Response  │        │
│  │ Confidence │    │ Confidence │    │ Confidence │        │
│  │   0.92     │    │   0.88     │    │   0.85     │        │
│  └─────┬──────┘    └─────┬──────┘    └─────┬──────┘        │
│        │                  │                  │              │
│        └──────────────────┼──────────────────┘              │
│                           │                                 │
│                           ▼                                 │
│                   ┌──────────────┐                          │
│                   │ Vote/Aggregate│                         │
│                   │   Response    │                         │
│                   └───────┬──────┘                          │
│                           │                                 │
└───────────────────────────┼─────────────────────────────────┘
                            │
                            ▼
┌──────────────────────────────────────────────────────────────┐
│                     Response Processing                       │
├──────────────────────────────────────────────────────────────┤
│  1. Format to OpenAI-compatible response                     │
│  2. Extract and store new memories                           │
│  3. Update provider metrics                                  │
│  4. Log to ClickHouse analytics                              │
│  5. Return to client                                         │
└──────────────────────────────────────────────────────────────┘
     │
     ▼
┌──────────┐
│  Client  │
│ Response │
└──────────┘
```

---

## Container Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    HELIXAGENT CONTAINER ORCHESTRATION                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                     BootManager (Unified)                            │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │  1. Read Containers/.env configuration                               │   │
│  │  2. Detect container runtime (Docker/Podman)                         │   │
│  │  3. Initialize Container Adapter                                     │   │
│  │  4. Check REMOTE_ENABLED flag                                        │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                         │
│              ┌─────────────────────┴─────────────────────┐                  │
│              │                                           │                  │
│              ▼                                           ▼                  │
│  ┌──────────────────────────┐          ┌──────────────────────────┐        │
│  │   LOCAL MODE             │          │   REMOTE MODE            │        │
│  │   (REMOTE_ENABLED=false) │          │   (REMOTE_ENABLED=true)  │        │
│  ├──────────────────────────┤          ├──────────────────────────┤        │
│  │                          │          │                          │        │
│  │  podman-compose up       │          │  1. Probe Remote Hosts   │        │
│  │                          │          │  2. Resource Scoring     │        │
│  │  Services:               │          │  3. Schedule Containers  │        │
│  │  ┌──────────────────┐   │          │  4. Distribute via SSH   │        │
│  │  │ PostgreSQL       │   │          │  5. Setup SSH Tunnels    │        │
│  │  │ Redis            │   │          │  6. Health Check Remote  │        │
│  │  │ ChromaDB         │   │          │  7. Mount Remote Volumes │        │
│  │  │ Cognee           │   │          │                          │        │
│  │  │ Grafana          │   │          │  Host: thinker.local     │        │
│  │  │ Prometheus       │   │          │  Runtime: Podman         │        │
│  │  │ (22 MCP Servers) │   │          │  Labels: storage=fast    │        │
│  │  └──────────────────┘   │          │                          │        │
│  │                          │          └──────────────────────────┘        │
│  │  Health Checks: TCP      │                                             │
│  │  Port: 5432, 6379, etc   │                                             │
│  │                          │                                             │
│  └──────────────────────────┘                                             │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                     Health Monitor                                   │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐                    │   │
│  │  │ TCP Check  │  │ HTTP Check │  │ Custom     │                    │   │
│  │  │ (Port)     │  │ (Endpoint) │  │ Script     │                    │   │
│  │  └──────┬─────┘  └──────┬─────┘  └──────┬─────┘                    │   │
│  │         │               │               │                          │   │
│  │         └───────────────┼───────────────┘                          │   │
│  │                         ▼                                          │   │
│  │              ┌─────────────────────┐                               │   │
│  │              │  Circuit Breaker    │                               │   │
│  │              │  (Failover Logic)   │                               │   │
│  │              └─────────────────────┘                               │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## Data Flow Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          DATA FLOW PIPELINES                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                     REQUEST LIFECYCLE                                │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │                                                                      │   │
│  │   Request ──▶ PostgreSQL ──▶ Cache ──▶ LLM ──▶ Response ──▶ Log    │   │
│  │   (users,    (llm_requests,  (Redis)   (22      (llm_       (Click- │   │
│  │    sessions)  llm_responses)           providers) responses) House) │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                     MEMORY PIPELINE                                  │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │                                                                      │   │
│  │   Input ──▶ Extract ──▶ Embed ──▶ Store ──▶ Search ──▶ Retrieve    │   │
│  │   Text      Entities   (OpenAI   (ChromaDB  (Vector    (Context    │   │
│  │   Content   & Facts    /6          +         Similarity  Injection) │   │
│  │                       providers)  PostgreSQL)                        │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                     DEBATE PIPELINE                                  │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │                                                                      │   │
│  │   Topic ──▶ Assign ──▶ Execute ──▶ Vote ──▶ Store ──▶ Learn        │   │
│  │   Input     Positions  25 Agents   6       Results   Cross-Session  │   │
│  │           (5×5 Grid)   × 8 Phases  Methods (debate_  Learning       │   │
│  │                                    (Weighted sessions)              │   │
│  │                                     /Majority                       │   │
│  │                                     /Borda)                         │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                     ANALYTICS PIPELINE                               │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │                                                                      │   │
│  │   Events ──▶ Buffer ──▶ Transform ──▶ Load ──▶ Query ──▶ Visualize │   │
│  │   (Real-   (Redis    (Enrich      (Click-  (SQL/     (Grafana     │   │
│  │    time)    Stream)   & Format)    House)   Graph)     Dashboards) │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

**Last Updated:** February 27, 2026  
**Architecture Version:** 2.0
